@(decisionSummary: DSummary, currentUserId: Option[Long], currentUserIsParticipant: Option[Boolean]) <!-- //, voteIfParticipantAndLogged: Option[Seq[CastedVote]]) -->

<h1>@decisionSummary.title</h1>

<br/>

@if(currentUserId.map(_ == decisionSummary.decision.ownerId).getOrElse(false)) {
   <a onClick='inviteVoters(@decisionSummary.decision.id)'>Invite voters</a>
}
<div class="row">

  <div class="span8">  
    @for(a <- decisionSummary.alternativeSummaries.sortBy(x => - x.points)) {
      <h4>@a.alternativeTitle</h4> <br/>
      <div id='progr@a.alternativeId' class="progress">
        <div class="bar" style="width: @a.percentageOfMaximumPoints(decisionSummary)%"></div>
      </div>
    }
  </div>
 <div class="span4" id="__dsum@decisionSummary.decision.id"></div>  
</div>

@for(b <- currentUserIsParticipant if b) {

  <div id="voteScreen" class="modal hide fade"></div>

  <a data-toggle="modal" onClick='popVote()' class="btn btn-primary btn-large">Vote</a>

  <a data-toggle="modal" onClick='inviteVoters(@decisionSummary.decision.id)' class="btn btn-primary btn-large">Invite Facebook friends</a>

  <script>

    function popVote() {
      $('#voteScreen').load('/vote/' + @decisionSummary.decision.id, function() {
        alert($('#voteScreen'))
        $('#voteScreen').modal('show')
      })
    }

    function inviteVoters(decisionId) {
      FB.ui({method: 'apprequests',
        message: 'Invitation to vote on ...',
        data: 'abc123'
      },
      function requestCallback(response) {
        if(response != null) {
          response.decisionId = decisionId
          var z = JSON.stringify(response)
          $.ajax({
            type: 'POST',
            url: "/recordInvitationList",
            data: z,
            success: function() {},
            contentType: "application/json; charset=utf-8",
            dataType: 'json'
          })
         }
      })
    }

  </script>
}
