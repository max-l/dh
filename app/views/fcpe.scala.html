@(centerPanelUriAndContent: (String,Html), displayName: Option[String], refreshCenterPanelAfterLoad: Boolean, clientSideFbLogin: Boolean)
<!DOCTYPE html>

<html>
    <head>

     <style type="text/css"></style>

     <link rel="stylesheet" href="@routes.Assets.at("stylesheets/bootstrap.css")">

     <link rel="stylesheet" 
            href="@routes.Assets.at("javascripts/jquery-custom/themes/ui-lightness/jquery-ui-1.8.18.custom.css")">

     <script src="@routes.Assets.at("javascripts/jquery-custom/jquery-1.7.1.js")"                  type="text/javascript"></script>
     <script src="@routes.Assets.at("javascripts/jquery-custom/ui/jquery-ui-1.8.18.custom.js")"    type="text/javascript"></script>

     <script src='@routes.Assets.at("javascripts/bootstrap-scrollspy.js")' type="text/javascript"></script>
     <script src='@routes.Assets.at("javascripts/bootstrap-collapse.js")'  type="text/javascript"></script>
     <script src='@routes.Assets.at("javascripts/bootstrap-tooltip.js")'   type="text/javascript"></script>
     <script src='@routes.Assets.at("javascripts/bootstrap-button.js")'   type="text/javascript"></script>
     <script src='@routes.Assets.at("javascripts/bootstrap-tab.js")'   type="text/javascript"></script>
     <script src='@routes.Assets.at("javascripts/bootstrap-modal.js")'  type="text/javascript"></script>
     
     <script src='@routes.Assets.at("javascripts/funcs.js")'  type="text/javascript"></script>
     
     <script type="text/javascript">

       function readCookie(name) {
         var nameEQ = name + "=";
         var ca = document.cookie.split(';');
         for(var i=0;i < ca.length;i++) {
           var c = ca[i];
           while (c.charAt(0)==' ') c = c.substring(1,c.length);
           if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
         }
         return null;
       }

       var dn = "@displayName.getOrElse("")"

       var loggedInStatusTimer = null
       var wasLoggedIn = null
       
       function isLoggedIn() {
         var z = readCookie("DISPLAY_AS_LOGGED_IN")
         wasLoggedIn = (z != null) && (z === "true")
         return wasLoggedIn
       }

       function refreshAuthenticatedStatus() {
         var h = null
         var b4 = wasLoggedIn
         if(isLoggedIn())
           h = "<li class='active'>" + dn + "<a onClick='logout()'>[Logout]</a></li>"
         else {
           h = "<li class='active'><a onClick='login()'>Login</a></li>"
           if(b4) {
             refreshCenterPanel()
           }
         }
         $('#loginStatus').html(h)
       }

       var centerPanelUrl = null

       function setCenterPanelUri(u) {
         if(u.lastIndexOf('/', 0) === 0)
           centerPanelUrl = u
         else 
           centerPanelUrl = '/' + u
       }

       setCenterPanelUri("@centerPanelUriAndContent._1")

       @if(!clientSideFbLogin) {
         $.fn.doLogIn = function() {
          window.location.href = "/externalLogin/facebook" + centerPanelUrl
         }
       }

       function login() {
         $.fn.doLogIn()
       }

       function logout() {
         window.location.href = "http://" + window.location.hostname + ':9000/logout'
       }

       function refreshCenterPanel() {
         ajaxAction(centerPanelUrl)
       }

       function ajaxAction(url) {
         if(url != null) {
           $('#centerPanel').load(url, function() {})
           setCenterPanelUri(url)
         }
       }

       function myDecisions() {
         ajaxAction('/decisionSummaries')
       }

       function decisionDetails(id) {
         ajaxAction('/p/' + id)
       }

       function newDecisions() {
         ajaxAction('/decision/create')
       }
     </script>

    </head>
    <body>


    <div id="fb-root"></div>
    <script>
      @facebookClientSideAuth("300426153342097") {
        @if(clientSideFbLogin) {

          var wasPromptedForAuthorisation = false;

          $.fn.doLogIn = function() {
             wasPromptedForAuthorisation = true
             FB.login()
          };

          FB.Event.subscribe('auth.statusChange', function(response) {
            if (response.authResponse) {
              // user has auth'd your app and is logged into Facebook
              $.ajax({
                type: 'POST',
                url: "/loginWithFacebookToken",
                data: JSON.stringify(response.authResponse),
                success: function() {
                
                },
                error: function(p1) {
                  alert("no !")
                },
                contentType: "application/json; charset=utf-8",
                dataType: 'json'
              })
            } else {
              if(wasPromptedForAuthorisation) {
                alert('NOT authorized : ...')
              }
            }
          })
        }
      }
    </script>


    <div class="container">

<!-- Navbar ================================================== -->
  <section id="navbar">
    <div class="navbar">
        <div class="container" style="width: auto;">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Decision Hub</a>
          <div class="nav-collapse">
            <ul class="nav">
  
              <li class="active"><a onClick='refreshCenterPanel()'>refresh center panel</a></li>
              
              <li class="active"><a onClick='myDecisions()'>My Decisions</a></li>
  
              <li class="divider-vertical"></li>
              
              <li class="active"><a onClick='newDecisions()'>New Decision</a></li>
              
              <li class="divider-vertical"></li>

              <li id='loginStatus' class="active"></li>
            </ul>
            <form class="navbar-search pull-left" action="">
              <input type="text" class="search-query span2" placeholder="Search"/>
            </form>
            <ul class="nav pull-right">
              <li><a href="#">About</a></li>
            </ul>
          </div>
        </div>
      
    </div><!-- /navbar -->
  </section>

  <section>
    <div class="container">
  
      <div id="centerPanel">
        @centerPanelUriAndContent._2
      </div>
  
    </div>
  
  </section>

  </div>
  <script>
    refreshAuthenticatedStatus()
    loggedInStatusTimer = window.setInterval(refreshAuthenticatedStatus, 10000)
    @if(refreshCenterPanelAfterLoad) {
      refreshCenterPanel()
    }
  </script>
  </body>
</html>
